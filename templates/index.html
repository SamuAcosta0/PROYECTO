{% extends "base.html" %}

{% block title %}NEXO - Motor de Precios (MVP){% endblock %}

{% block content %}
  <header class="page-header">
    <h1>NEXO – Motor de Precios (MVP)</h1>
    <p>Explorá los precios registrados aplicando los filtros disponibles.</p>
  </header>

  <section class="filters">
    <form method="get" class="filters__form">
      <div class="form-row">
        <label for="producto">Producto</label>
        <select id="producto" name="producto">
          <option value="">Todos</option>
          {% for producto in productos %}
            <option value="{{ producto.id }}" {% if filters.producto == producto.id %}selected{% endif %}>
              {{ producto.nombre }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label for="barrio">Barrio</label>
        <select id="barrio" name="barrio">
          <option value="">Todos</option>
          {% for barrio in barrios %}
            <option value="{{ barrio.id }}" {% if filters.barrio == barrio.id %}selected{% endif %}>
              {{ barrio.nombre }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label for="comercio">Comercio</label>
        <select id="comercio" name="comercio">
          <option value="">Todos</option>
          {% for comercio in comercios %}
            <option value="{{ comercio.id }}" {% if filters.comercio == comercio.id %}selected{% endif %}>
              {{ comercio.nombre }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="form-row">
        <label for="fecha_desde">Fecha desde</label>
        <input
          type="date"
          id="fecha_desde"
          name="fecha_desde"
          value="{{ filters.fecha_desde or '' }}"
        />
      </div>

      <div class="form-row">
        <label for="fecha_hasta">Fecha hasta</label>
        <input
          type="date"
          id="fecha_hasta"
          name="fecha_hasta"
          value="{{ filters.fecha_hasta or '' }}"
        />
      </div>

      <div class="form-actions">
        <button type="submit">Filtrar</button>
      </div>
    </form>
  </section>

  <section class="map">
    <h2>Mapa de precios</h2>
    <div id="map" style="height: 400px;"></div>
  </section>

  {% if filters.producto %}
    <section class="summary">
      <h2>Resumen para el producto seleccionado</h2>
      <div class="summary__cards">
        <article class="card">
          <h3>Mínimo</h3>
          <p>{{ resumen.minimo }}</p>
        </article>
        <article class="card">
          <h3>Máximo</h3>
          <p>{{ resumen.maximo }}</p>
        </article>
        <article class="card">
          <h3>Promedio</h3>
          <p>{{ resumen.promedio }}</p>
        </article>
        <article class="card">
          <h3>Cantidad</h3>
          <p>{{ resumen.cantidad }}</p>
        </article>
      </div>
    </section>
  {% endif %}

  <section class="results">
    <h2>Resultados</h2>
    {% if precios %}
      <table class="results__table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Marca</th>
            <th>Comercio</th>
            <th>Barrio</th>
            <th>Fuente</th>
            <th>Precio</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          {% for precio in precios %}
            <tr>
              <td>{{ precio.producto }}</td>
              <td>{{ precio.marca }}</td>
              <td>{{ precio.comercio }}</td>
              <td>{{ precio.barrio }}</td>
              <td>{{ precio.fuente }}</td>
              <td>{{ precio.precio }}</td>
              <td>{{ precio.fecha }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No se encontraron precios para los filtros seleccionados.</p>
    {% endif %}
  </section>
{% endblock %}
